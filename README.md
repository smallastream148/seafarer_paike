# 📚 智能排课系统 (Smart Course Scheduling System)

[![Python](https://img.shields.io/badge/Python-3.8%2B-blue)](https://www.python.org/)
[![Streamlit](https://img.shields.io/badge/Streamlit-1.28%2B-red)](https://streamlit.io/)
[![License](https://img.shields.io/badge/License-MIT-green)](LICENSE)

一个功能强大的智能排课系统，支持自动排课（遗传算法）和手动排课两种模式，具有美观的用户界面和完善的约束管理。

## ✨ 主要特性

### 🤖 自动排课模块
- **遗传算法优化**：使用先进的遗传算法自动生成最优排课方案
- **硬约束验证**：确保教师时间不冲突、班级时间不冲突、先修课程顺序等
- **软约束优化**：优化课程分布均匀性、教师工作量平衡等
- **可配置参数**：种群大小、迭代代数、随机种子等参数可调

# ⚓️ 船员培训智能排课系统
- **直观的拖拽界面**：通过点击和选择轻松安排课程
- **实时约束检查**：添加课程时自动检查所有约束条件
- **撤销/重做功能**：支持操作撤销，避免误操作
- **进度追踪**：实时显示各课程完成进度

### 🎨 界面特性
- **现代化UI设计**：采用渐变色彩和卡片式布局
- **响应式设计**：自适应不同屏幕尺寸
- **暗黑模式**：支持日间/夜间主题切换
- **可视化图表**：进度条、统计图表等直观展示

## 📁 项目结构

```
seafarer_paike/
├── auto_schedule/          # 自动排课模块
│   ├── __init__.py
│   ├── cli.py             # 命令行接口
│   ├── config.py          # 配置管理
│   ├── constraints.py     # 约束条件定义
│   ├── data_model.py      # 数据模型
│   ├── export_util.py     # 导出工具
│   └── ga_engine.py       # 遗传算法引擎
│
├── manual_schedule/        # 手动排课模块
│   ├── __init__.py
│   ├── app_manual.py      # Streamlit 主应用
│   ├── manual_core.py     # 核心排课逻辑
│   ├── manual_soft.py     # 软约束评估
│   ├── manual_state.py    # 状态管理
│   ├── export_util.py     # 导出工具
│   └── assets/            # 静态资源
│       ├── style.css      # 主样式文件
│       └── style_dark.css # 暗黑模式样式
│
├── 排课数据.xlsx          # 输入数据文件（示例）
├── analyze_courses.py     # 课程分析工具
├── verify_dual.py         # 双师验证工具
└── README.md             # 项目说明文档
```

## 🚀 快速开始

### 环境要求
- Python 3.8 或更高版本
- pip 包管理器

### 安装依赖

```bash
pip install -r requirements.txt
```

如果没有 requirements.txt，请安装以下包：

```bash
pip install streamlit pandas openpyxl deap numpy
```

### 运行程序

#### 手动排课界面（推荐）
```bash
streamlit run manual_schedule/app_manual.py
```

程序将在浏览器中自动打开，默认地址：http://localhost:8502

#### 自动排课（命令行）
```bash
python -m auto_schedule.cli
```

## 📖 使用指南

### 1. 数据准备
在 `排课数据.xlsx` 文件中准备以下数据：
- **班级信息**：班级ID、开始日期、结束日期、课程列表
- **课程信息**：课程名称、课时数、教师列表、是否双师、先修课程
- **教师信息**：教师姓名、不可用时间
- **班级不可用时间**：特定班级的不可用时段

### 2. 手动排课流程
1. 启动程序后，选择要排课的班级
2. 查看课程进度和剩余课时
3. 点击空白时段的"➕ 添加"按钮
4. 选择课程和教师
5. 点击保存完成添加
6. 使用撤销按钮可以撤销上一步操作

### 2.1 手动添加规则（硬/软约束）
- 适用位置：
   - 课表单元格中的“添加课程”表单
   - 顶部“➕ 手动添加课程块（可强制）”面板
- 保存前检查：
   - 硬约束（必须满足）：若存在冲突，直接报错并阻止保存。例如：教师冲突、班级该时段不可用、先修未完成、双师教师重复等。
   - 软约束（优化目标）：计算保存前后软约束分数变化（Δsoft），仅提示不阻止保存：
      - Δsoft > 0：提示为警告（越大越差）
      - Δsoft = 0：提示无变化
      - Δsoft < 0：提示为改善（负值代表更优）
- 单元格点击规则：仅当该时段“已有课程”时禁止再次添加；即使标记为“不可用”或“课程剩余为 0”也可尝试打开添加表单，是否能保存以硬约束检查为准。
- 实际提交：通过统一的 add_block 接口落库，支持撤销，保证与硬约束校验一致。

### 3. 自动排课流程
1. 点击"🤖 自动排课"展开面板
2. 设置算法参数：
   - 种群大小：建议 60-100
   - 迭代代数：建议 200-500
   - 随机种子：用于结果复现
3. 点击"🚀 开始运行"
4. 等待算法完成，查看结果

### 4. 导出结果
- 支持导出为 Excel 文件
- 可选择导出当前班级或所有班级
- 包含教师工作量统计

## 🎯 约束说明

### 硬约束（必须满足）
- ✅ 教师时间不冲突
- ✅ 班级时间不冲突
- ✅ 先修课程必须先排
- ✅ 理论课教师固定
- ✅ 双师课需要两名不同教师

### 软约束（优化目标）
- 📊 课程分布均匀性
- ⚖️ 教师工作量平衡
- 🔄 理论实操交替
- 📅 课程连续性

## 🛠️ 高级配置

### 修改样式
编辑 `manual_schedule/assets/style.css` 文件可以自定义界面样式。

### 算法参数调优
在 `auto_schedule/config.py` 中可以调整：
- 交叉概率
- 变异概率
- 精英保留比例
- 适应度函数权重

## 🐛 常见问题

### Q: 程序无法启动？
A: 请确保已安装所有依赖包，特别是 streamlit。

### Q: 自动排课结果不理想？
A: 尝试增加迭代代数或调整种群大小。

### Q: 如何重置所有数据？
A: 点击"🔄 清除缓存"按钮即可重置。

## 📝 更新日志

### v2.0.0 (2024-01)
- 🎨 全新UI设计，采用现代化界面
- ✨ 添加暗黑模式支持
- 🔧 重构代码结构，提高可维护性
- 📊 改进课表视图布局
- 🐛 修复多个已知问题

### v1.0.0 (2023-12)
- 🚀 初始版本发布
- ✅ 实现基础排课功能
- 📁 支持Excel导入导出

## 🤝 贡献指南

欢迎提交 Issue 和 Pull Request！

## 📄 许可证

本项目采用 MIT 许可证。详见 [LICENSE](LICENSE) 文件。

## 👥 联系方式

如有问题或建议，请通过以下方式联系：
- 提交 GitHub Issue
- 发送邮件至：[your-email@example.com]

---

**Made with ❤️ by Your Team**
